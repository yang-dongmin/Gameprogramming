# Tower Defense Web Game   

---

## 변경 및 신규 함수 설명

### showSelectPanel() / showDetailPanel(t) / hidePanel()
**파일:** tower.js  
**역할:** 타워 정보 UI 표시 및 전환  
- **showSelectPanel()** : 빈 타일 클릭 시 타워 선택 버튼 섹션을 표시한다.  
- **showDetailPanel(t)** : 설치된 타워 클릭 시 해당 타워의 이름, 공격력, 속도, 사거리 정보를 표시하며, 강화된 수치는 (+값) 형태로 출력한다.  
- **hidePanel()** : 모든 패널을 숨긴다.  

**개선 내용:**  
UI가 겹쳐 보이던 문제를 해결하고, 클릭 상황에 따라 패널을 전환하도록 변경하여 사용자 경험을 개선하였다.

---

### updateTowers()
**파일:** tower.js  
**역할:** 타워 공격, 상태 효과, 보상 처리의 핵심 루프  
- 각 타워가 사거리 내 적을 탐색하고 공격한다.  
- 공격 시 projectiles 배열에 투사체를 생성한다.  
- 슬로우 타워는 범위 내 적의 속도를 0.7배로 감소시킨다.  
- 화염 타워는 주변 적에게 2초간 화상 피해 상태를 부여하고 폭발 이펙트를 생성한다.  
- 사망한 적을 제거하고 보상금(+2원)을 지급한다.  
- 일정 시간이 지나면 슬로우 및 화상 상태를 자동 해제한다.  

**개선 내용:**  
기존 단순 공격 로직을 투사체 기반 및 상태 이상 시스템으로 변경하였다.  
`performance.now()`를 사용하여 지속 시간 관리를 정밀하게 수행하고, `explosions[]` 및 `frosts[]` 배열을 이용한 시각 효과를 추가하였다.

---

### updateProjectiles()
**파일:** tower.js  
**역할:** 투사체 이동 및 충돌 판정  
- 투사체가 목표 적까지 이동하며 도착 시 피해를 적용하고 제거된다.  
- 사망한 적이나 존재하지 않는 목표는 즉시 삭제된다.  

**개선 내용:**  
직선형 공격 방식을 실제 이동 투사체로 변경하였으며,  
타워 종류에 따라 다른 색상으로 구분할 수 있게 하였다.

---

### canvas.addEventListener('click', …) (2곳)
**파일:** tower.js  
**역할:**  
1. 빈 셀 클릭 시 타워 설치 패널 표시  
2. 설치된 타워 클릭 시 상세 정보 패널 표시  
- 빈 타일 클릭 시 selectedCell에 좌표를 저장하고 `showSelectPanel()` 호출  
- 설치된 타워 클릭 시 selectedTower를 갱신하고 `showDetailPanel()` 호출  
- 동일 타워 재클릭 시 선택 해제 및 패널 닫기  

**개선 내용:**  
타워 설치와 정보 표시 이벤트를 분리하여 중복 클릭 시 UI가 겹치던 문제를 해결하였다.

---

### upgradeDamageBtn / upgradeSpeedBtn / upgradeRangeBtn 클릭 핸들러
**파일:** tower.js  
**역할:** 선택된 타워의 능력치 강화  
- 강화 시 5원이 차감되고 investedMoney에 누적된다.  
- 공격력 +0.5, 공격속도 +0.2, 사거리 +10 증가.  
- 강화 후 즉시 UI가 갱신된다.  

**개선 내용:**  
버튼별 기능을 독립적으로 구성하여 유지보수가 용이해졌다.  
강화 수치에 소수점 처리를 적용하여 UI 가독성을 높였다.

---

### sellTowerBtn 클릭 핸들러
**파일:** tower.js  
**역할:** 타워 판매 및 환급 처리  
- 선택된 타워를 towers 배열에서 제거하고, 해당 좌표를 towerCells에서 해제한다.  
- 투자 금액의 70%를 계산하여 환급한다.  
- 판매 후 패널을 닫고 금액 UI를 갱신한다.  

**개선 내용:**  
새로운 판매 기능을 추가하였으며, 판매된 위치에 다시 타워를 설치할 수 있도록 셀 초기화 로직을 구현하였다.

---

### draw()
**파일:** draw.js  
**역할:** 렌더링 및 시각 효과 처리  
- 사거리 원을 hoverTower 및 selectedTower에만 표시하도록 수정.  
- 화염 상태(isBurning)와 슬로우 상태(slowed)인 적에게 각각 붉은/푸른 오라 효과 추가.  
- 폭발(explosions) 및 얼음 파동(frosts) 이펙트를 렌더링하도록 추가.  

**개선 내용:**  
단순 도형 기반 렌더링에서 벗어나 시각 효과를 강화하였다.  
`ctx.createRadialGradient()`를 사용해 자연스러운 빛 번짐 효과를 구현하였다.

---

### spawnWave()
**파일:** enemy.js  
**역할:** 웨이브별 적 생성  
- 웨이브 시작 시 다음 웨이브 버튼을 비활성화한다.  
- 일정 간격으로 적을 생성하고 웨이브 종료 후 2초 뒤 자동으로 다음 웨이브를 확인한다.  

**개선 내용:**  
웨이브 진행 상태에 따른 자동 재활성화 로직을 추가하고,  
UI 업데이트 기능(`updateUI()`)을 연동하였다.

---

### buildPathCells(points)
**파일:** map.js  
**역할:** 경로 데이터를 기반으로 실제 격자 셀 계산  
- path 배열의 좌표를 기반으로 경로 셀을 자동 생성한다.  
- 경로 셀은 타워 설치가 불가능한 구역으로 지정된다.  

**개선 내용:**  
경로를 자동으로 계산하여 맵 수정 시 유지보수가 용이해졌다.


## 개발 프롬프트 정리

### 1. 초반 정보 입력 + 타워 클릭 시 맵 우측 타워 정보 표시
- 기존 웹 타워 디펜스 게임에 기능을 추가하는 과제 수행 중.
- 담당 파트: 타워 관련 로직 (타워 종류, 사거리, 공격력, 공격속도, 강화, 판매, 사거리 표시, 공격 모션 등).
- 팀 구성:
  - 본인: 타워 로직 담당
  - 팀원: 적과 UI 담당
- 요구사항:
  - 타워에 마우스를 올리면 `id="gameCanvas"` 오른쪽에 `width="250"`, `height="450"`의 UI가 나타나야 함.
- 피드백:
  - 타워 클릭 시 UI가 나타날 때 `gameCanvas`가 밀리는 문제 발생 → `gameCanvas` 위치를 고정하고 그 옆에 UI가 표시되도록 수정 필요.

---

### 2. 타워에 마우스 올리거나 클릭 시 사거리 표시
- 타워 클릭 또는 hover 시 사거리를 시각적으로 표시해야 함.
- 클릭 시에는 사거리 표시가 유지되고, 다시 클릭하면 사라져야 함.
- 사거리 표시 방식은 원형으로, 타워의 중심을 기준으로 표현.

---

### 3. 맵 격자 형태로 변경
- 맵을 격자 형태로 시각화하여 모든 셀 위치를 명확히 확인할 수 있게 함.
- 각 셀은 타워 설치 가능 구역과 불가능 구역으로 구분.
- 적의 이동경로(`path`)에 포함된 셀은 설치 불가능하도록 설정.

---

### 4. tower_defense.js, tower.js 기능별 파일 분리
- `tower_defense.js`와 `tower.js`를 기능별로 독립된 JS 파일로 분리.
- import/export 없이 전역 변수로 상호작용하는 구조 유지.
- file:// 환경에서도 바로 실행 가능해야 함.
- 예시 파일 구조:
  - `main.js` : 전체 제어 및 루프 관리
  - `map.js` : 맵, 경로, 셀 관리
  - `enemy.js` : 적 스폰 및 이동 처리
  - `tower.js` : 타워 로직 담당
  - `ui.js` : UI 표시 및 갱신
  - `draw.js` : 그래픽 렌더링 담당

---

### 5. 타워 종류 추가
- 격자형 맵에서 타일 클릭 시 해당 타일이 연한 파란색으로 표시(선택된 상태).
- `id="towerInfoPanel"` 내에서 타워 종류 버튼 표시.
- 타워 종류를 선택하면 해당 위치에 선택한 타워를 설치.
- 설치 후 선택 UI는 사라지고, 타워 정보 UI가 표시되도록 구현.

---

### 6. 타워 판매 기능 추가
- 타워 판매 기능 구현.
- 각 타워는 설치 및 강화 시 사용한 금액을 `investedMoney` 변수에 누적 저장.
- 판매 시 투자 금액의 70%를 환급받도록 구현.
- 기존 기능(설치, 강화, 공격, 사거리 표시 등)은 변경 없이 유지.

---

### 7. 스플래시, 슬로우 타워 변경
- 기존 스플래시 타워 기능을 슬로우 타워가 가지도록 변경.
- 스플래시 타워를 화염 타워로 교체.
- 화염 타워는 단일 공격형으로, 공격 시 적에게 2초간 지속적인 피해(burn) 부여.
- 슬로우, 화염 상태의 적은 각 상태에 맞는 시각 효과(파란빛/붉은빛 오라)를 표시.

---

### 8. 투사체 이펙트 추가
- 공격 시 실제 투사체가 날아가 적에게 명중하면 피해를 주는 시스템 구현.
- 각 타워는 고유한 투사체 속성(색상, 속도, 크기, 시각 효과)을 가짐.
- 기존의 단순한 선형 공격선을 제거하고 투사체로 대체.
- 화염 타워와 슬로우 타워는 특별한 공격 방식과 시각 효과를 가짐.
- 다른 기능(타워 배치, 강화, 판매, 사거리 표시 등)은 기존 로직 유지.

---

### 9. 인트로, 아웃트로 추가
- **인트로 화면**
  - 게임 시작 전 표시되며 “게임 시작” 버튼만 표시.
  - 인트로 상태에서는 체력, 돈, 웨이브 UI가 숨겨져 있음.
- **아웃트로 화면**
  - 게임 종료 시 전체 화면에 “게임 오버” 및 “다시 시작” 버튼 표시.
  - “다시 시작” 클릭 시 게임 데이터(타워, 적, 웨이브 등) 초기화 후 인트로로 돌아감.
